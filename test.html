<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Details</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: monospace;
        }
        pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Area Details</h1>
        <pre id="output">Loading...</pre>
    </div>

    <script>
        async function processAreaDetails() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/JwowSquared/Radical-Red-Pokedex/master/data.js');
                let data = await response.text();
                data = new Function("return " + data + ";")();

                const milestones = [
                    { name: "Pewter City Gym", cap: 16 },
                    { name: "Mt. Moon B2F", cap: 23 },
                    { name: "Cerulean City Gym", cap: 28 },
                    { name: "Vermilion City Gym", cap: 36 },
                    { name: "Celadon City Gym", cap: 44 },
                    { name: "Rocket Hideout B4F", cap: 47 },
                    { name: "Silph Co. 11F", cap: 57 },
                    { name: "Saffron City Gym", cap: 59 },
                    { name: "Fuchsia City Gym", cap: 68 },
                    { name: "Cinnabar Island", cap: 73 },
                    { name: "Cerulean Cave B1F", cap: 80 },
                    { name: "Viridian City Gym", cap: 81 },
                    { name: "Route 23", cap: 82 },
                    { name: "Pokemon League", cap: 85 },
                    { name: "One Island", cap: 100 }
                ];

                let currentCap = 16;
                let milestoneIndex = 0;

                const getSpeciesName = (id) => data.species[id]?.name || `Unknown Species ${id}`;

                const encounterKeys = [
                    'wild-day', 'wild-night', 'wild-surf', 
                    'wild-oldRod', 'wild-goodRod', 'wild-superRod',
                    'wild-smash', 'raid1', 'raid2', 'raid3', 'raid4', 
                    'raid5', 'raid6', 'fixed-gift', 'fixed-overworld', 
                    'fixed-roaming', 'fixed-trade'
                ];

                const GOOD_ROD_CAP = 36;  
                const WATER_UNLOCKS_CAP = 68; 

                const processedAreas = {};

                for (const [id, area] of Object.entries(data.areas)) {

                    if (area.name === milestones[milestoneIndex]?.name) {
                        currentCap = milestones[milestoneIndex].cap;
                        milestoneIndex++;
                    }

                    if (milestoneIndex > 0 && area.name !== milestones[milestoneIndex - 1].name) {
                        currentCap = milestones[milestoneIndex - 1].cap;
                    }

                    processedAreas[id] = {
                        name: area.name,
                        levelCap: currentCap,
                        trainers: [],
                        encounters: []
                    };

                    Object.values(data.trainers).forEach(trainer => {
                        if (trainer.areaName === area.name) {
                            let trainerName = trainer.name;
                            if (trainerName.includes("Rival Blue")) {
                                trainerName = "Our Rival";
                            }
                            if (!processedAreas[id].trainers.includes(trainerName)) {
                                processedAreas[id].trainers.push(trainerName);
                            }
                        }
                    });

                    encounterKeys.forEach(key => {

                        if ((key === 'wild-superRod' || key === 'wild-surf') && currentCap < WATER_UNLOCKS_CAP) return;

                        if (key === 'wild-goodRod' && currentCap < GOOD_ROD_CAP) return;

                        if (area[key]) {
                            Object.entries(area[key]).forEach(([_, encounters]) => {
                                if (Array.isArray(encounters)) {
                                    encounters.forEach(encounter => {
                                        let encounterData;

                                        if (key.startsWith('raid')) {
                                            if (Array.isArray(encounter)) {
                                                encounterData = {
                                                    species: getSpeciesName(encounter[0]),
                                                    method: key
                                                };
                                            } else {
                                                encounterData = {
                                                    species: getSpeciesName(encounter),
                                                    method: key
                                                };
                                            }
                                        } else if (Array.isArray(encounter)) {
                                            encounterData = {
                                                species: getSpeciesName(encounter[0]),
                                                minLevel: encounter[1],
                                                maxLevel: encounter[2] || encounter[1],
                                                method: key
                                            };
                                        } else if (typeof encounter === 'number') {
                                            encounterData = {
                                                species: getSpeciesName(encounter),
                                                method: key
                                            };
                                        }

                                        const isDuplicate = processedAreas[id].encounters.some(existing => 
                                            existing.species === encounterData.species &&
                                            existing.minLevel === encounterData.minLevel &&
                                            existing.maxLevel === encounterData.maxLevel
                                        );

                                        if (!isDuplicate) {
                                            processedAreas[id].encounters.push(encounterData);
                                        }
                                    });
                                }
                            });
                        }
                    });

                    processedAreas[id].encounters.sort((a, b) => a.species.localeCompare(b.species));

                    if (processedAreas[id].encounters.length === 0) {
                        delete processedAreas[id].encounters;
                    }
                }

                document.getElementById('output').textContent = 
                    JSON.stringify(processedAreas, null, 2);

            } catch (error) {
                document.getElementById('output').textContent = 
                    'Error processing area details: ' + error.message;
                console.error('Error:', error);
            }
        }

        window.addEventListener('load', processAreaDetails);
    </script>
</body>
</html>